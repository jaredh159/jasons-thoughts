---
import striptags from 'striptags';
import { englishMonths } from '../lib/dates';
import { DualPost } from '../types';

interface Props {
  post: DualPost;
}

const { post } = Astro.props as Props;

let emailResponse = false;
let previewText =
  striptags(post.en.content).replace('&nbsp;', ' ').substring(0, 400).trim() + '...';

if (previewText.startsWith('[A response to an email]')) {
  emailResponse = true;
  previewText = previewText
    .replace('[A response to an email]', '')
    .replace('&nbsp;', ' ');
}
---

<div
  class='shadow-lg border-[0.5px] rounded-xl relative bg-white flex flex-col justify-start items-start ml-10'
>
  <div
    class='absolute w-20 h-20 rounded-full shadow-md bg-white -left-10 top-6 flex flex-col items-center justify-center border-[0.5px]'
  >
    <h3 class='uppercase text-gray-400 text-sm font-light'>
      {englishMonths[post.publishedAt.getMonth()].substring(0, 3)}
    </h3>
    <h3 class='text-2xl text-sky-500'>{post.publishedAt.getDate()}</h3>
  </div>
  <div class='p-6 pl-16 pb-4'>
    <div>
      <h2 class='text-xl font-inter text-gray-900'>{post.en.title}</h2>
      {emailResponse && (
        <span class="text-sm text-gray-400 mt-1">A response to an email</span>
      )}
    </div>
    <p class='mt-3 mb-3 text-gray-500' set:html={previewText}></p>
  </div>
  <div class='p-4 flex justify-end w-full bg-slate-50 rounded-b-xl'>
    <a
      class='block self-end px-4 py-2 text-sky-500 transition duration-100 hover:text-sky-600 cursor-pointer rounded-lg bg-sky-100'
      href={`/posts/${post.en.slug}`}
    >
      Read post <i class='fa-solid fa-arrow-right ml-1'></i>
    </a>
  </div>
</div>
